@startuml
title Agent Services - Complete Integration Sequence\nPLATEAU ↔ Agent Services ↔ Licensing ↔ Audit Data Flow

skinparam dpi 150
skinparam sequence {
  ArrowColor #1976D2
  ActorBorderColor #1976D2
  LifeLineBorderColor #1976D2
  LifeLineBackgroundColor #E8F4FD
  ParticipantBorderColor #4CAF50
  ParticipantBackgroundColor #E8F5E8
  ParticipantFontColor #2E7D32
  ActorBackgroundColor #FFF3E0
  ActorFontColor #E65100
  NoteBackgroundColor #FFF9C4
  NoteBorderColor #F57F17
}

actor "Terry\n(Operations)" as Terry
actor "Marketing Rep\n/ General Agent" as Marketing
participant "PLATEAU Core" as Plateau
participant "Agent Services\nModule" as AgentServices
participant "Licensing\nModule" as Licensing
participant "Audit & Logging" as Audit
participant "E-Sign Platform" as ESign
participant "Loan Platform\nProvider" as LoanPlatform
database "Database\n(EntityMaster, etc.)" as DB

== 1. Authentication & Navigation ==
Terry -> Plateau: Login (Active Directory)
Plateau -> Terry: Authentication successful
Terry -> Plateau: Navigate to Agent Services
Plateau -> AgentServices: **INTEGRATION #1**\nRoute to Agent Services module
note right: Shared authentication\nUnified navigation\nConsistent UI/UX

== 2. Form Submission & Validation ==
Marketing -> AgentServices: Submit NEW ACCOUNT SETUP\nor AGENT CHANGE REQUEST
note right: **AUTOMATION #1**\nWeb Form vs PDF\n• Real-time validation\n• No email delays\n• Document attachments
AgentServices -> AgentServices: Validate form data
AgentServices -> Plateau: Request Senior Officer approval
Plateau -> Terry: Display approval workflow
Terry -> Plateau: Submit for approval
Plateau -> AgentServices: **INTEGRATION #2**\nApproval status update
note right: Shared approval workflow\nStatus synchronization

== 3. Document Generation & E-Sign ==
AgentServices -> AgentServices: Auto-generate Master Policies\nand Producer Agreements
note right: **AUTOMATION #2**\nDocument Generation\n• State-specific templates\n• Pre-filled agent data\n• Version control
AgentServices -> ESign: Send documents for signature
note right: **AUTOMATION #3**\nE-Sign Integration\n• Signature tracking\n• Reminder notifications\n• Document storage
ESign -> Marketing: Request signatures
Marketing -> ESign: Sign documents
ESign -> AgentServices: Signature status update

== 4. Database Operations ==
AgentServices -> DB: Create EntityMaster record
DB -> AgentServices: EntityMaster ID returned
AgentServices -> DB: Create AgentSetupDirect records
AgentServices -> DB: Create AgentSetupMasterCredit records
AgentServices -> DB: Create AgentSetupValuesCredit records
note right: **AUTOMATION #4**\nAutomated Database Setup\n• C# automated operations\n• Hierarchical table management\n• Bulk operations support\n• No manual Excel operations

== 5. Licensing Integration ==
AgentServices -> Licensing: **INTEGRATION #3**\nAgent data for licensing
note right: Shared agent data\nIntegrated appointment management
Licensing -> DB: Update licensing appointments
Licensing -> Licensing: Generate monthly letters
note right: **AUTOMATION #5**\nLicensing Integration\n• Automated letter generation\n• Email validation\n• Delivery tracking
Licensing -> Licensing: Generate annual cleanup letters
Licensing -> AgentServices: Licensing status update

== 6. Platform Integration ==
AgentServices -> LoanPlatform: Send worksheet + release
LoanPlatform -> AgentPlatform: Enable forms/rates
LoanPlatform -> AgentServices: Confirmation

== 7. Audit & Logging ==
AgentServices -> Audit: **INTEGRATION #4**\nLog EntityMaster changes
note right: Centralized logging system\nCross-module audit trails
Licensing -> Audit: Log licensing activities
Audit -> DB: Store audit records
Audit -> Plateau: Send status notifications
note right: **AUTOMATION #6**\nStatus Tracking & Notifications\n• Real-time updates\n• Performance monitoring\n• Exception handling

== 8. Data Synchronization ==
loop For each change
  AgentServices -> Plateau: Sync agent status
  Plateau -> AgentServices: Confirm sync
  AgentServices -> Licensing: Sync licensing data
  Licensing -> AgentServices: Confirm sync
  AgentServices -> Audit: Log synchronization
end

== 9. Exception Handling ==
alt Commission mismatch detected
  AgentServices -> Terry: Display error notification
  Terry -> AgentServices: Review and correct
  AgentServices -> DB: Update corrected data
  AgentServices -> Audit: Log correction
  AgentServices -> Plateau: Update status
  AgentServices -> Marketing: Notify of changes
end

== 10. Report Processing & Final Setup ==
AgentServices -> AgentServices: Wait for first monthly report
AgentServices -> DB: Query agent setup status
DB -> AgentServices: Return setup data
alt First report received
  AgentServices -> AgentServices: Complete agent configuration
  AgentServices -> DB: Update all plan tables
  AgentServices -> Audit: Log completion
  AgentServices -> Plateau: Update final status (ACTIVE)
else No report received
  AgentServices -> AgentServices: Remain PENDING
  AgentServices -> Audit: Log pending status
end

== 11. Additional Process Elements ==
note over AgentServices, LoanPlatform: **Additional Process Elements**\n• Agent Change Requests\n• Reinsurance Agreements\n• Retro Agreements\n• Certificate Management\n• Rate Maintenance\n• Filing Process

@enduml
